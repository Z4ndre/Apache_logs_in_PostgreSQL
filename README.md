
## Введение
Реализовано два сервиса
1. flaskAlchemy.py
   - API для запроса данных из логов Apache.
   - Предоставляет интерфейс для получения данных из логов через HTTP-запросы.

2. windows.py
   - Графическое приложение для просмотра сохранённых в базе данных (БД) данных.
   - Позволяет пользователям просматривать и анализировать данные логов в удобном графическом интерфейсе.

## Другие файлы

- **config.ini**
  - **Описание**: Файл с основными настройками для работы приложения.
  - **Содержание**: Содержит конфигурационные параметры, такие как адреса серверов, учетные данные для доступа к БД и другие важные настройки.

- **db.py**
  - **Описание**: Отвечает за соединение с базой данных и вызов процедуры добавления строк из логов в БД.

- **db_dump_postgresql.sql**
  - **Описание**: Дамп базы данных, использованной при тестировании приложения и API.
  - **Использование**: Может быть использован для восстановления тестовой среды или для анализа структуры данных.

- **main_script.sql**
  - **Описание**: Файл с основными скриптами базы данных.

- **messages_for_user.py**
  - **Функциональность**: Предоставляет механизм для информирования пользователей о проблемах, возникающих при работе системы.

## Установка 
**Шаг 1:**

 Для систем Windows:
 
 Откройте командную строку (CMD) или PowerShell от имени администратора.
 Загрузите репозиторий выполнив следующие команды:

```cmd
git clone https://github.com/Z4ndre/Apache_logs_in_PostgreSQL.git
cd Apache_logs_in_PostgreSQL
```
**Шаг 2:**

Создание виртуального окружения

В командной строке (CMD) или PowerShell (от имени администратора)
- Создайте виртуальное окружение с помощью команды:
  ```cmd
  python -m venv apache_log_postgre_env
  ```

**Шаг 3:**

Установка необходимых библиотек Python:
| Библиотека          | Версия  >=  |
|---------------------|-------------|
| requests            | 2.32.3      |
| psycopg2            | 2.9.9       |
| pandas              | 2.2.2       |
| Flask               | 3.0.3       |
| Flask-SQLAlchemy    | 3.1.1       |
| PyQt6               | 6.7.0       |

Установка библиотек возможна выполнив следующие команды:

```cmd
pip install requests
pip install psycopg2
pip install pandas
pip install Flask
pip install Flask-SQLAlchemy
pip install PyQt6
```

**Шаг 4:**

Требуется указать свои данные для корректной работы приложения и API.
В файле:

**config.ini**

```python
[DataBase]
# Параметры для подключения к БД 
dbname = practice_spring
user = postgres
password = 12345
host = 127.0.0.1
port = 5432
procedure_name = apache_logs_insert

[Api]
# Для запуска на локальном сервере можно оставить параметры как есть
host = 0.0.0.0
port = 5000
url = /get_all_info

[Files]
# Путь к файлу логов Apache
path_to_log_file = ...\Server\Apache24\logs\access.log

[db_files]
# Данную переменную нужно оставить как есть если вы хотите записать логи начиная с первого символа в файле логов
last_char = 0
```

**Шаг 5:**

Установите формат сохранения логов Apache в файле находящемся по пути:
```
основной_путь...\Server\Apache24\conf\httpd.conf
```
Нужно найти строку:
```
LogFormat "%h %l %u %t \"%r\" %>s %b" common
```
Конфигурация логов в данном файле при тестировании не менялась, оставлено по дефолту для Windows. Фильтрация и сохранение нужных параметров в БД реализована через регулярное выражение в файле **window.py** . 
Регулярное выражение настроено для сохранения логов в формате:
```
format = %h %l %t "%r" %>s %b
```
В случае изменения **LogFormat** в файле .conf, настоятельно рекомендую проверить регулярное выражение и изменить его при необходимости, для корректной работы приложения.

## API ## 
**flaskAlchemy** предоставляет конечную точку API по адресу http://127.0.0.1:5000/get_all_info для получения данных логов Apache сохранённых в БД.
Параметры запроса:
- ip_address=  Фильтрация логов по IP-адресу
- status_code= Фильтрация логов по Статус Коду
- start_date= Фильтрация логов от выбранной даты, формат даты dd/MMM/yyyy
- end_date= Фильтрация логов до выбранной даты, формат даты dd/MMM/yyyy
- ?start_date=*дата*&end_date=*дата* Фильтрация логов в выбранном промежутке времени
- group_by_ip=True Включена группировка результатов по IP-адресу
  
Примеры запросов:
```cmd
curl -X GET "http://127.0.0.1:5000/get_all_info"
curl -X GET "http://127.0.0.1:5000/get_all_info?ip_address=::1"
curl -X GET "http://127.0.0.1:5000/get_all_info?start_time=2024-06-01T00:00:00&end_time=2024-06-10T23:59:59"
curl -X GET "http://127.0.0.1:5000/get_all_info?group_by_ip=true"
```

## Приложение ##

![image](https://github.com/Z4ndre/Apache_logs_in_PostgreSQL/assets/148073988/93d6a400-3581-4582-adfc-363e75bbd3ed)

Данные в таблице из API, проверьте правильность заполнения port, host и url для корректной работы в файле **config.ini**

**Фильтрация**
- По IP-адресу
- Дата от
- Дата до
- Есть возможность переключать режим группировки по IP
  
Данные в таблице обновляются по нажатию кнопки.

